<script>
    is_set = parseInt(Qualtrics.SurveyEngine.getEmbeddedData("is_set"));
    no_libs =  typeof d3 == 'undefined' || typeof EmbeddedData == 'undefined' || typeof ImgProperties == 'undefined' || typeof ImgQuestion == 'undefined'
    if (is_set != 1 || no_libs) {
        jQuery.when(
            jQuery.getScript("https://d3js.org/d3.v7.min.js"),
            jQuery.getScript("https://cdn.jsdelivr.net/gh/jimmy-narang/SVB@latest/EmbeddedData.js"),
            jQuery.getScript("https://cdn.jsdelivr.net/gh/jimmy-narang/SVB@latest/ImgProperties.js"),
            jQuery.getScript("https://cdn.jsdelivr.net/gh/jimmy-narang/SVB@latest/ImgQuestion.js"),
            jQuery.getScript("https://cdn.jsdelivr.net/gh/jimmy-narang/SVB@latest/header.js"),
            jQuery.Deferred(function (deferred) {
                jQuery(deferred.resolve);
            })
        ).done(function () {
            console.log("Libraries loaded.");
            var linkToImgDB = EmbeddedData.getValue(EMMISC.IMG_DB_URL);
            console.log("Fetching images data from " + linkToImgDB);

            d3.csv(linkToImgDB).then(
                // Fetch images from google sheets
                getImgDB).then(function () {
                // Assign images to different rounds
                assignImgsToRounds();
                Qualtrics.SurveyEngine.setEmbeddedData("is_set", 1);
            });
        });
    } else {
        console.log('Libraries already loaded. Loading page.');
        loadPage();
    }
</script>